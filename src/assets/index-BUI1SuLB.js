import{_ as Z,r as M,b as ee,d as te,c as r,a as v,F as A,l as L,e as f,f as g,s as U,q as X,t as ae,x as se,o as c,m as R,z as y,T as b,A as ne}from"./index-BuWtbWgA.js";import{T as V}from"./toast-D-c1V8F9.js";import{B as z}from"./button-lfGp2GGb.js";import{I as H}from"./icons-BNI7CP4i.js";import{g as oe}from"./index-CH_iu5NA.js";const le={class:"cardList"},ie={key:0,style:{height:"100%",width:"100%"}},re=["src"],ce={key:0,class:"card-loading"},ue={class:"dot-box"},de={key:0,class:"info"},fe={class:"title"},he={class:"changeBox"},me={__name:"index",props:{isMobile:{type:Boolean,default:!1}},setup(P){const u=P,h=M([]),D=M(!1);async function B(){D.value=!0;const e=Date.now()+Math.random().toString(36).substring(2),n={id:e,pic:null};h.value.push(n),await U(),I(!0);async function o(){for(;;){const[m,T]=await X("/api/v1/autoCreateMix");if(T)return[null,T];if(m.data.code==200)return ae("/api/v1/GetTitle",{prompt:m.data.result.task_params.raw_prompt}).then(([d,w])=>{if(!w){const i=h.value.findIndex(t=>t.id===e);if(i!==-1){let t=d.data.title;t.includes("**")&&(t=t.match(/\*\*(.*?)\*\*/)[1]||t),t.includes("“")&&(t=t.match(/“(.*?)”/)[1]||t),t.includes('"')&&(t=t.match(/"(.*?)"/)[1]||t),h.value[i].title=t}}}),[m,null];await new Promise(d=>setTimeout(d,1e3))}}const[s,l]=await o();if(l)V("图片加载失败: "+(l.response.data.msg||l.msg||"未知错误"));else{async function m(){for(;;){const[i,t]=await X(`/api/v1/mix_picture/${s.data.result.task_id}`);if(t)return[null,t];if(i.data.code!==200)return[null,{response:i}];if(i.data.result.finished){const _=i.data.result.images_url[0];try{return[await se.get(_,{responseType:"blob"}),null]}catch(N){return[null,N]}}await new Promise(_=>setTimeout(_,1e3))}}const[T,d]=await m();if(d){console.error(d),V("图片加载失败: "+(d.response.data.msg||d.msg||"未知错误"));return}const w=new FileReader;w.readAsDataURL(T.data),w.onloadend=()=>{const i=w.result,t=h.value.findIndex(_=>_.id===e);t!==-1&&(h.value[t].pic=i),D.value=!1}}}const a=M(0),x=M(!1);let F=0,k=0;const W=e=>{x.value=!0,F=e},$=e=>{x.value&&(k=e-F)},p=async e=>{if(e==="up")if(a.value<h.value.length-1)a.value++;else{if(D.value)return;B(),await U(),a.value++}else e==="down"&&a.value>0&&a.value--};let S=0;const q=async e=>{const n=Date.now();n-S<750||(S=n,e.deltaY>0?await p("up"):e.deltaY<0&&await p("down"))},Y=async()=>{x.value=!1,k>100?await p("down"):k<-100&&await p("up"),k=0},G=e=>W(u.isMobile?e.clientX:e.clientY),O=e=>$(u.isMobile?e.clientX:e.clientY),j=async()=>await Y(),J=e=>W(u.isMobile?e.touches[0].clientX:e.touches[0].clientY),K=e=>$(u.isMobile?e.touches[0].clientX:e.touches[0].clientY),Q=async()=>await Y();let E;ee(()=>{B(),I(!0),E=setInterval(()=>{I()},5e3)}),te(()=>{clearInterval(E)});const C=M([]),I=e=>{C.value.forEach((n,o)=>{if(!n){C.value.splice(o,1);return}const s=n.parentElement;oe.to(n,{x:()=>{const l=s.clientWidth;return Math.random()*l-l/2-50},y:()=>{const l=s.clientHeight;return Math.random()*l-l/2-50},background:()=>{const l=["#FF5733","#FFC300","#DAF7A6","#3CB371","#6C3483"];return l[Math.floor(Math.random()*l.length)]},opacity:Math.random()*.5+.5,duration:e?0:7,ease:"power1.inOut",delay:e?0:Math.random()*2})})};return(e,n)=>(c(),r("div",{class:"root",onMousedown:G,onMousemove:O,onMouseup:j,onTouchstart:J,onTouchmove:K,onTouchend:Q,onWheel:q},[v("div",le,[(c(!0),r(A,null,L(h.value,(o,s)=>(c(),r("div",{class:"card",key:o.id,style:R({opacity:a.value===s?1:0,transform:`translate(calc(${u.isMobile?a.value===s?-50:(a.value-s)*-100+-50:-50}% + ${u.isMobile?a.value===s?0:(s-a.value)*10:0}px), calc(${u.isMobile||a.value===s?-50:(a.value-s)*-100+-50}% + ${u.isMobile||a.value===s?0:(s-a.value)*10}px))`})},[f(b,{name:"fade"},{default:g(()=>[a.value===s?(c(),r("div",ie,[f(b,{name:"fade"},{default:g(()=>[o.pic?(c(),r("div",{key:0,class:"img-before",style:R({backgroundImage:`url(${o.pic})`})},null,4)):y("",!0)]),_:2},1024),f(b,{name:"fade"},{default:g(()=>[o.pic?(c(),r("img",{key:0,src:o.pic,class:"pic"},null,8,re)):y("",!0)]),_:2},1024),f(b,{name:"fade"},{default:g(()=>[o.pic?y("",!0):(c(),r("div",ce,[v("div",ue,[(c(),r(A,null,L(6,l=>v("div",{class:"dot",key:l,ref_for:!0,ref:m=>C.value.push(m)})),64))]),n[2]||(n[2]=v("div",{class:"loader"},null,-1))]))]),_:2},1024),a.value===s&&o.title?(c(),r("div",de,[v("div",fe,ne(o.title),1)])):y("",!0)])):y("",!0)]),_:2},1024)],4))),128))]),v("div",he,[f(z,{onClick:n[0]||(n[0]=o=>p("down")),circle:!0,class:"up"},{default:g(()=>[f(H,{class:"icon",name:"chevron-right"})]),_:1}),f(z,{onClick:n[1]||(n[1]=o=>p("up")),circle:!0,class:"down"},{default:g(()=>[f(H,{class:"icon",name:"chevron-right"})]),_:1})])],32))}},Me=Z(me,[["__scopeId","data-v-7a8c2fa9"]]);export{Me as default};
