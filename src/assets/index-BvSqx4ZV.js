import{B as y}from"./button-lfGp2GGb.js";import{I as v}from"./icons-BNI7CP4i.js";import{T as i}from"./toast-D-c1V8F9.js";import{W as S}from"./style-M5Mq9gkc.js";import{_ as L,r as b,b as B,D,c as x,o as f,a as k,q as I,j,B as C,z as R,y as T,e as u,f as A,g as z,F as E,t as w,C as _}from"./index-BuWtbWgA.js";import{c as O}from"./modal-B9HYtgKl.js";const M=["src","data-src"],N={__name:"lazyImg",props:{src:{type:String,required:!0},placeholder:{type:String,default:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},type:{type:String,default:"common"}},emits:["loaded"],setup(g,{emit:l}){const c=g,p=l,r=b(null),m=b(!1);let s=null;const n=()=>{p("loaded")},e=()=>{m.value||(m.value=!0,c.type==="common"?r.value.src=r.value.dataset.src:c.type==="wardrobe"&&I("/api/v1/user/clothes/ClothesPicture/"+c.src).then(([o,a])=>{if(a){console.log(a),i("加载失败: "+(a.response?.data?.message||a.message||"未知错误"));return}r.value.src=o.data.picture}))},t=()=>{s=new IntersectionObserver(o=>{o.forEach(a=>{a.isIntersecting&&(e(),s.unobserve(a.target))})}),s.observe(r.value)};return B(()=>{t()}),D(()=>{s&&r.value&&(s.unobserve(r.value),s.disconnect())}),(o,a)=>(f(),x("div",null,[k("img",{class:"img",ref_key:"imgRef",ref:r,src:g.placeholder,"data-src":g.src,onLoad:n},null,40,M)]))}},P=L(N,[["__scopeId","data-v-9289aa3f"]]),V={key:0,class:"tipsBox"},F={class:"item"},$={class:"buttonGroup"},q={__name:"index",props:{isMobile:{type:Boolean,default:!1}},setup(g){const l=j(),c=b([]),p=async()=>{l.setLoadingStatus(!0);const[s,n]=await I("/api/v1/user/clothes/ClothesList").finally(async()=>{l.setLoadingStatus(!1)});n||(c.value=Object.entries(s.data.data).map(([e,t])=>({id:t})))};B(async()=>{await p()});const r=()=>{const s=async e=>new Promise((t,o)=>{l.setLoadingStatus(!0);const a=new FileReader;a.readAsDataURL(e),a.onload=async()=>{const[d,h]=await w("/api/v1/user/clothes/upload",{clothes:a.result},{headers:{"Content-Type":"application/json"}});h?(console.log(h),o(h)):t(null)},a.onerror=d=>{console.log(d),o(d)}}).finally(async()=>{await p(),l.setLoadingStatus(!1)}),n=O({title:"上传新的衣物",content:()=>_("div",{style:{width:"100%",borderRadius:"10px",border:"3px dashed var(--color-box-border)",color:"var(--primary-color)",backgroundColor:"var(--color-box)",boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center",padding:"15px",cursor:"pointer"},onDrop:async e=>{e.preventDefault();const t=e.dataTransfer.files[0];if(t.type!=="image/jpeg"&&t.type!=="image/png"){i("请上传jpg或png格式的图片");return}const o=await s(t);o?i("上传失败: "+(o.response.data.message||o.message||"未知错误")):(i("上传成功"),n.close())},onClick:e=>{e.preventDefault();const t=document.createElement("input");t.type="file",t.accept="image/png, image/jpeg",t.click(),t.onchange=async o=>{const a=o.target.files[0],d=await s(a);d?i("上传失败: "+(d.response.data.message||d.message||"未知错误")):(i("上传成功"),n.close())}},onDragover:e=>{e.preventDefault()}},[_(v,{name:"arrow-up",style:{fontSize:"30px"}},"这是具体内容")]),footer:()=>_("div",{style:{display:"flex",justifyContent:"flex-end",gap:"5px",marginTop:"1rem"}},[_(y,{onClick:()=>{n.close()}},{default:()=>"取消"})]),closeOnClickOutside:!1});n.open()},m=async s=>{l.setLoadingStatus(!0);const[n,e]=await w("/api/v1/user/clothes/delete",{clothes_id:s}).finally(async()=>{l.setLoadingStatus(!1)});e?i("删除失败: "+(e.response.data.message||e.message||"未知错误")):(i("删除成功"),p())};return(s,n)=>(f(),x(E,null,[!c.value.length>0?(f(),x("div",V,[n[0]||(n[0]=T(" 请先添加衣物 ")),u(y,{class:"button",circle:!0,onClick:r},{default:A(()=>[u(v,{name:"arrow-up"})]),_:1})])):(f(),C(z(S),{key:1,list:c.value,class:"box",align:"left"},{default:A(({item:e})=>[k("div",F,[u(P,{class:"img",src:e.id,type:"wardrobe",alt:e.id},null,8,["src","alt"]),k("div",$,[u(y,{class:"button",circle:!0,onClick:t=>m(e.id)},{default:A(()=>[u(v,{name:"trash-blank"})]),_:2},1032,["onClick"])])])]),_:1},8,["list"])),c.value.length>0?(f(),C(y,{key:2,class:"updateButton",circle:!0,onClick:r},{default:A(()=>[u(v,{name:"arrow-up"})]),_:1})):R("",!0)],64))}},K=L(q,[["__scopeId","data-v-791d0db3"]]);export{K as default};
