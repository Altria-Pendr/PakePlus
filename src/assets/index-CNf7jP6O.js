import{_ as L,j as E,r as b,b as R,B as T,c as x,a as l,A as I,e as c,f as h,q as D,t as q,C as u,o as y,N as V}from"./index-BuWtbWgA.js";import{I as v}from"./icons-BNI7CP4i.js";import{B as d}from"./button-lfGp2GGb.js";import{I as F}from"./input-BM_f-ZFN.js";import{T as r}from"./toast-D-c1V8F9.js";import{c as M}from"./modal-B9HYtgKl.js";const O={key:1,class:"page"},$={class:"header"},z=["src"],H={key:1,class:"defAvatar"},G={class:"userAvatarEdit"},W={class:"userInfo"},J={class:"userName"},K={class:"body"},Q={class:"item-box"},X={class:"item-box"},Y={class:"item-box"},Z={__name:"index",setup(ee){const C=E(),w=b(!0),m=b(null),f=b("");function P(){try{navigator.clipboard.writeText(m.value.UserId),r("用户ID已复制")}catch{r("用户ID复制失败")}}async function U(){const[s,e]=await D("/api/v1/info/GetUserInfo").finally(()=>{w.value=!1});if(e)r("用户信息加载失败:"+(e.response.data.message||e.message||"未知错误"));else{m.value=s.data;const[o,a]=await D("/api/v1/user/ProfilePicture",{responseType:"blob"});if(a)r("头像加载失败: "+(a.response.data.message||a.message||"未知错误"));else if(o.data.type!="application/json"){const n=new FileReader;n.onload=()=>{f.value=n.result},n.onerror=t=>{r("头像加载失败"),console.error("Base64转换失败:",t)},n.readAsDataURL(o.data)}}}R(async()=>{await U()});function A(s){s.preventDefault()}async function N(s){s.preventDefault();const e=s.dataTransfer.files[0];if(e.type!=="image/jpeg"&&e.type!=="image/png"){r("请上传jpg或png格式的图片");return}await B(e)}function S(s){const e=document.createElement("input");e.type="file",e.accept="image/png, image/jpeg",e.click(),e.onchange=async o=>{const a=o.target.files[0];await B(a)}}async function B(s){r("头像上传中");const e=new FormData;e.append("file",s);const[o,a]=await q("/api/v1/user/UploadProfilePicture",e).finally(()=>{w.value=!1});a?(console.error("头像上传失败",a),r("头像上传失败: "+(a.response.data.message||"未知错误"))):(r("头像上传成功"),f.value=await new Promise((n,t)=>{const i=new FileReader;i.onload=()=>{n(i.result)},i.onerror=g=>{t(),r("头像加载失败"),console.error("Base64转换失败:",g)},i.readAsDataURL(s)}))}const k=async s=>{const e=b({});if(s=="healthInfo"){C.setLoadingStatus(!0);const[t,i]=await D("/api/v1/user/Health").finally(()=>{C.setLoadingStatus(!1)});i||(e.value=t.data)}const a={healthInfo:{title:"修改我的数据",content:[{label:"（必填）性别",name:"sex",type:"select",value:e.value.sex||"未知",options:[{label:"男",value:"男"},{label:"女",value:"女"}],url:"/api/v1/user/HealthUpdate",required:!0},{label:"（必填）身高（cm）",name:"height",type:"number",value:e.value.height?.replace(/[^0-9.]/g,"")||"0",after:"cm",required:!0},{label:"（必填）体重（kg）",name:"weight",type:"number",value:e.value.weight?.replace(/[^0-9.]/g,"")||"0",after:"kg",required:!0},{label:"（必填）年龄",name:"age",type:"number",value:e.value.age||"0",required:!0},{label:"臂围",name:"arm_circumference",type:"number",after:"cm",value:e.value.arm_circumference?.replace(/[^0-9.]/g,"")},{label:"臂长",name:"arm_length",type:"number",after:"cm",value:e.value.arm_length?.replace(/[^0-9.]/g,"")},{label:"胸围",name:"bust_circumference",type:"number",after:"cm",value:e.value.bust_circumference?.replace(/[^0-9.]/g,"")},{label:"足长",name:"foot_length",type:"number",after:"cm",value:e.value.foot_length?.replace(/[^0-9.]/g,"")},{label:"足宽",name:"foot_width",type:"number",after:"cm",value:e.value.foot_width?.replace(/[^0-9.]/g,"")},{label:"鞋码",name:"shoe_size",type:"number",value:e.value.shoe_size?.replace(/[^0-9.]/g,"")},{label:"肩宽",name:"shoulder_width",type:"number",after:"cm",value:e.value.shoulder_width?.replace(/[^0-9.]/g,"")},{label:"肤色",name:"skin_color",type:"text",value:e.value.skin_color},{label:"大腿周长",name:"thigh_circumference",type:"number",after:"cm",value:e.value.thigh_circumference?.replace(/[^0-9.]/g,"")},{label:"腰围",name:"waist_circumference",type:"number",after:"cm",value:e.value.waist_circumference?.replace(/[^0-9.]/g,"")}]},username:{title:"修改用户名",content:[{label:"新用户名",name:"Username",type:"text",url:"/api/v1/user/ChangeUsername",value:"",required:!0}]},password:{title:"修改密码",content:[{label:"老密码",name:"OldPassword",type:"password",url:"/api/v1/auth/ChangePassword",value:"",required:!0},{label:"新密码",name:"NewPassword",type:"password",value:"",required:!0}]}}[s]||null;if(!a){r("参数错误");return}const n=M({title:a.title,content:()=>u("div",{},a.content.map(t=>u("div",[u("label",{style:{display:"block",fontWeight:"bold",marginBottom:"0.5rem"}},t.title||t.label),u(F,{type:t.type,label:t.label,modelValue:t.value,options:t.options,"onUpdate:modelValue":i=>t.value=i,name:t.name})]))),footer:()=>u("div",{style:{display:"flex",justifyContent:"flex-end",gap:"5px"}},[u(d,{onClick:()=>{n.close()}},{default:()=>"取消"}),u(d,{onClick:async()=>{if(a.content.some(_=>_.required&&!_.value)){r("请填写完整信息");return}const t=a.content.reduce((_,p)=>({..._,[p.name]:p.after?p.value+p.after:p.value}),{}),[i,g]=await q(a.content[0].url,t);g?r("修改失败:"+(g.response.data.message||"未知错误")):(U(),r("修改成功"),n.close())}},{default:()=>"确定"})])});n.open()},j=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/"};return(s,e)=>w.value?(y(),T(V,{key:0})):(y(),x("div",O,[l("div",$,[l("div",{class:"userAvatar",onDrop:N,onDragover:A,onClick:S},[f.value?(y(),x("img",{key:0,src:f.value,alt:"avatar"},null,8,z)):(y(),x("div",H,[l("i",null,I(m.value?.UserName?.substring(0,1)),1)])),l("div",G,[c(v,{name:"edit",class:"userAvatarEditIcon"})])],32),l("div",W,[l("span",J,I(m.value?.UserName||"用户"),1),l("span",{class:"userID",onClick:P}," @"+I(m.value?.UserId?.substring(0,10)||"xxx")+"...(点击复制) ",1)])]),l("div",K,[l("div",Q,[c(d,{class:"item",onClick:e[0]||(e[0]=o=>k("healthInfo"))},{default:h(()=>[e[3]||(e[3]=l("span",{class:"item-title"}," 我的数据 ",-1)),c(v,{class:"item-icon",name:"chevron-right"})]),_:1,__:[3]})]),l("div",X,[c(d,{class:"item",onClick:e[1]||(e[1]=o=>k("username"))},{default:h(()=>[e[4]||(e[4]=l("span",{class:"item-title"}," 修改用户名 ",-1)),c(v,{class:"item-icon",name:"chevron-right"})]),_:1,__:[4]}),c(d,{class:"item",onClick:e[2]||(e[2]=o=>k("password"))},{default:h(()=>[e[5]||(e[5]=l("span",{class:"item-title"}," 修改密码 ",-1)),c(v,{class:"item-icon",name:"chevron-right"})]),_:1,__:[5]})]),l("div",Y,[c(d,{class:"item",onClick:j},{default:h(()=>[e[6]||(e[6]=l("span",{class:"item-title"}," 退出登录 ",-1)),c(v,{class:"item-icon",name:"chevron-right"})]),_:1,__:[6]})])])]))}},oe=L(Z,[["__scopeId","data-v-9ae0bd2c"]]);export{oe as default};
